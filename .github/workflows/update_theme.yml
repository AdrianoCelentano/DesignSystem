name: Sync Design System (Kotlin)

on:
  push:
    paths:
      - 'tokens.json'
  pull_request:
    types: [ opened, synchronize ]

# ADD THIS SECTION to enable the manual button
  workflow_dispatch:
    inputs:
      reason:
        description: 'Why are you running this?'
        required: false
        default: 'Manual update'

jobs:
  update-theme:
    # ðŸ›‘ ONLY RUN if the source branch starts with 'design/'
    if: startsWith(github.head_ref, 'design_system')
    permissions:
      contents: write

    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref }}

      # INSTALL KOTLIN
      - name: Setup Kotlin
        uses: fwilhe2/setup-kotlin@v1
        with:
          version: 2.0.20 # or latest

      # RUN THE SCRIPT
      - name: Generate Compose Code
        run: kotlin convert_tokens.main.kts

      # DEBUG & STAGE
      - name: Stage Changes
        run: |
          echo "Current status:"
          git status
          git add app/src/main/java/com/adriano/designsystem/ui/theme/*.kt
          echo "Status after add:"
          git status

      # COMMIT AND PUSH CHANGES
      - name: Commit and Push Changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "design: update compose theme"
          # Removed file_pattern to rely on the manual git add above
